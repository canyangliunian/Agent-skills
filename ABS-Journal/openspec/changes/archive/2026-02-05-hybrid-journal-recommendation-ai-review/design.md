## Context

当前推荐能力由脚本完成：读取本地 AJG CSV → 候选集筛选（按 field）→ 计算 `fit/easy/value` 排序分 → 输出 Markdown 报告。该实现的优势是可复现、完全离线；但由于本地 CSV 缺少期刊 aims&scope 等“期刊侧主题文本”，脚本在跨学科应用题（AI+政治经济、媒体+教育、金融排斥等）场景容易出现“贴合度解释不足/排序不符合直觉”的问题。

本变更引入混合流程：脚本负责生成“粗范围候选池”（可追溯、可复现），AI 仅在候选池内完成“细筛 + 解释输出”。该流程的核心约束是：**AI 不得推荐候选池之外的期刊**，并且必须输出结构化清单（序号/期刊名/ABS 星级/期刊主题）。

约束与利益相关者：

- 约束：默认只使用本地 AJG CSV；只有用户显式要求才更新/抓取数据；候选池必须可复现。
- 使用者：凌贵旺（Guiwang Ling），需要长期重复使用并能快速比较 `fit/easy/value` 三类推荐。
- 运行环境：本仓库 Python 脚本 + 本地数据文件；AI 二次筛选在运行时由 agent 执行（不写入明文凭据，不自动联网更新 AJG 数据）。

## Goals / Non-Goals

**Goals:**

- 引入“脚本候选池 → AI 二次筛选”的推荐架构，显著提升主题贴合与解释性。
- 确保 AI 二次筛选严格遵守硬约束：只在候选池内选刊，禁止推荐目录外/候选池外期刊。
- 为 `fit/easy/value` 三类分别输出 Top10（或用户指定 TopK），每条包含：
  - 序号
  - 期刊名
  - ABS/AJG 星级（以本地 CSV 为准）
  - 期刊主题（AI 生成的自然语言短描述，服务“为什么适合”）
- 结果可追溯：报告中包含候选池参数（field、星级过滤、候选池规模、候选池来源文件路径/年份）。

**Non-Goals:**

- 不引入必须联网的外部期刊信息源（如实时审稿周期、APC、最新指南等）。
- 不将“期刊主题”写成权威事实陈述；主题描述定位为“基于题目/摘要与候选池的解释性摘要”，必须避免幻觉式断言（尤其是具体期刊政策）。
- 不改变 AJG 数据抓取机制（除非用户明确提出更新数据库）。

## Decisions

1) 架构：两段式流水线（候选池生成 vs AI 细筛）

- 决策：将推荐拆成两个可单独复现的步骤：
  - Step A（脚本）：生成候选池（包含期刊名、星级、field、以及用于解释的数值/文本字段），并输出为结构化格式（JSON + 可选 Markdown 表格）。
  - Step B（AI）：读取候选池，在其范围内为 `fit/easy/value` 生成 Top10，并补充“期刊主题”字段。
- 理由：用脚本保证“范围正确 + 可复现”，用 AI 解决“缺乏期刊侧主题文本时的解释性与语境匹配”。
- 备选方案：
  - 仅调脚本关键词/规则（否决）：容易过拟合，且难以覆盖所有跨学科主题。

2) 硬约束：候选池 ID 锁定 + 输出校验

- 决策：候选池中每条期刊分配稳定标识（至少包含 `journal_title + ajg_2024`；更稳健可加入 CSV 行号或哈希），AI 输出必须逐条能在候选池中找到匹配。
- 理由：防止 AI “编造期刊/跑出候选池”。
- 备选方案：
  - 只靠提示词约束（不足）：无法对抗模型幻觉，需要做程序化校验。

3) 交互契约：AI 输出格式固定为表格/清单

- 决策：AI 的最终输出采用固定列：
  - `序号 | 期刊名 | ABS星级 | 期刊主题`
  并对 `fit/easy/value` 分块输出（各 10 条）。
- 理由：满足用户汇报习惯、便于复制到文档/邮件；也便于后续自动化检查。

4) 可复现性：候选池快照可选落盘

- 决策：默认不强制落盘（避免写入过多文件），但提供可选参数将候选池写入 `outputs/`（或临时目录），用于回放与对比。
- 理由：兼顾易用与可追溯；当用户反馈“这次推荐不对”时可复现当时候选池。

## Risks / Trade-offs

- [AI 幻觉/越界推荐] → Mitigation：候选池硬约束 + 程序化校验（输出必须全部在候选池中）+ 报告中明确“仅在候选池内推荐”。
- [AI 输出不稳定（同一输入多次结果不同）] → Mitigation：保留脚本候选池 + 允许指定随机种子/温度（如未来接入 API）或在本地实现确定性 tie-break（后续实现阶段定）。
- [候选池过大导致 AI 负担/成本高] → Mitigation：脚本支持可配置的候选池规模（例如每类模式先取 TopN=200 再交给 AI）。
- [主题描述可能不准确] → Mitigation：主题描述要求“短、保守、基于标题摘要推断”，避免具体事实断言；必要时在输出中加入“（AI 解释性摘要）”标注。
